<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect Your Wallet</title>
    <!-- Include Web3Modal and Ethers.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3modal/1.9.1/web3modal.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ethersproject/providers@5.5.2/lib/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.5.4/dist/ethers.umd.min.js"></script>
    <style>
        body {
            text-align: center;
            margin: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 20px;
        }
    </style>
</head>
<body>
    <h1>Connect Your Wallet</h1>
    <button id="connect-wallet">Connect Wallet</button>

    <script>
        let provider;
        const connectButton = document.getElementById('connect-wallet');

        connectButton.addEventListener('click', async () => {
            // Initialize Web3Modal with wallet providers (MetaMask, Trust Wallet, Ledger)
            const web3Modal = new Web3Modal({
                cacheProvider: false, // optional
                providerOptions: {}   // Use default options to support MetaMask, Trust Wallet, Ledger
            });

            try {
                // Open modal to select wallet provider
                const instance = await web3Modal.connect();
                provider = new ethers.providers.Web3Provider(instance);

                // Get the connected wallet address
                const signer = provider.getSigner();
                const walletAddress = await signer.getAddress();

                // Send wallet address to Telegram bot server
                fetch('https://santavik3214321.github.io/tgwalbotintentis11/send_address', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: '288054607',  // Replace with actual user chat ID
                        wallet_address: walletAddress
                    })
                }).then(response => {
                    // Close mini-app after successful connection
                    window.Telegram.WebApp.close();  // Close mini-app in Telegram
                });

            } catch (error) {
                console.error("User rejected the connection or there was an issue.", error);
                alert("Could not connect to the wallet. Please ensure you have MetaMask or Trust Wallet installed.");
            }
        });
    </script>
</body>
</html>
